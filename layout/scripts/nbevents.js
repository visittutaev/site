var _paq=_paq||[],nb_event=nb_event||function(){function getPage(){var e=document.URL;return e.indexOf("page=")+1?document.URL.split("page=")[1]:1}function NextPage(){ClearEventsListDiv(),jqEvent("body:not(:animated)").animate({scrollTop:0},1e3),jqEvent("html").animate({scrollTop:0},500),GetEvents(!1)}function getEventCode(){var e=document.getElementById("nbEventsScript"),t=e.src.replace(/^[^\?]+\??/,""),n=parseQuery(t);return n.eventCode}function returnSiteKey(){return"630ca8a816444a03bfd5521dc3ccb892&subKey=43904658"}function returnTagsIdsParameter(){return"1568"}function parseQuery(e){var t=new Object;if(!e)return t;for(var n=e.split(/[;&]/),s=0;s<n.length;s++){var a=n[s].split("=");if(a&&2==a.length){var i=unescape(a[0]),o=unescape(a[1]);o=o.replace(/\+/g," "),t[i]=o}}return t}function resize(){jqEvent(".ui-dialog").width(jqEvent(window).width()-7),jqEvent(".ui-dialog").height(jqEvent(window).height()-10)}function showPriceForm(){self.siteKey=nb_config.apiKey,self.eventCode=nb_config.eventCode;var e="";jqEvent("#ActiveDate").length>0&&(e="&dateId="+jqEvent("#ActiveDate").val()),addWidgetCss(),jqEvent.ajax({dataType:"jsonp",url:serverUrl+"/EventWidget/SingleEventTickets/?siteKey="+self.siteKey+"&eventCode="+self.eventCode+e,jsonp:"jsoncallback",success:function(e){0!=e.Html.length&&jqEvent("#nb_events").html(e.Html)},error:function(e){alert("Ошибка 500, Событие не найдено")}})}function addWidgetCss(){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=serverUrl+"/Widget/widgetStyles.css",document.getElementsByTagName("head")[0]?document.getElementsByTagName("head")[0].appendChild(e):document.write('<link rel="stylesheet" href="data:text/css,'+escape(stylesImport)+'"/>'),"undefined"!=typeof nb_config.widgetThemeCss&&(document.getElementsByTagName("head")[0]?jqEvent("head").append('<link rel="stylesheet" href="'+nb_config.widgetThemeCss+'" type="text/css" />'):document.write('<link rel="stylesheet" href="'+nb_config.widgetThemeCss+'" type="text/css" />')),"undefined"!=typeof nb_config.customWidgetCss&&(document.getElementsByTagName("head")[0]?jqEvent("head").append('<link rel="stylesheet" href="'+nb_config.customWidgetCss+'" type="text/css" />'):document.write('<link rel="stylesheet" href="'+nb_config.customWidgetCss+'" type="text/css" />'))}function vote(e,t){var n=parseInt(e),s="1";"down"==t&&(s="2"),window.open("http://auth.nbcrs.org/?eventId="+n+"&type="+s,"VoteWindow","width=650,height=380")}function init(){jqEvent.cachedScript=function(e,t){return t=jqEvent.extend(t||{},{dataType:"script",cache:!0,async:!0,url:e}),jqEvent.ajax(t)},self.siteKey=returnSiteKey(),self.tagsIds=returnTagsIdsParameter(),self.page=getPage(),0==jqEvent("div.nb_hidden").length&&jqEvent("html").append("<div class='nb_hidden'></div>");var rootForEventDiv=document.getElementById("nb_events");if(0==jqEvent("div.nb_topMessage").length){var d2=document.createElement("div");d2.id="nb_topMessage",rootForEventDiv.appendChild(d2)}if(0==jqEvent("div.nb_topMessageTags").length){var d4=document.createElement("div");d4.id="nb_topMessageTags",jqEvent("#nb_topMessage").append(d4)}if(0==jqEvent("#nb_eventIframeCont").length){var d1=document.createElement("div");d1.id="nb_eventIframeCont",d1.style.display="none",jqEvent(d1).appendTo(rootForEventDiv)}if(jqEvent("#nb_eventIframeCont").css("overflow-x","Hidden"),jqEvent(window).resize(function(){resize()}),0==jqEvent("div.nb_eventsCont").length){var d3=document.createElement("div");d3.id="nb_eventsCont",rootForEventDiv.appendChild(d3)}if(addWidgetCss(),"undefined"!=typeof jqEvent.ui)(!jqEvent.fn.datepicker||jqEvent.fn.dialog)&&jqEvent.cachedScript(serverUrl+"/bundles/jqueryui").done(function(e,t){jqEvent.datepicker.setDefaults(jqEvent.datepicker.regional.ru)}).fail(function(e,t,n){alert("Error on load JQuery UI! "+n)});else{var s2=document.createElement("link");s2.type="text/css",s2.rel="stylesheet",s2.async=!0,s2.href=serverUrl+"/Content/themes/base/css",document.getElementsByTagName("head")[0]&&document.getElementsByTagName("head")[0].appendChild(s2)}jqEvent.cachedScript(serverUrl+"/bundles/jqueryui").done(function(e,t){jqEvent.datepicker.setDefaults(jqEvent.datepicker.regional.ru)}).fail(function(e,t,n){alert("Error on load JQuery UI! "+n)});var settings=GetWidgetSettings();jqEvent.cachedScript(serverUrl+"/bundles/widgetPlugins").done(function(script,textStatus){jqEvent("#nb_events").waypoint(function(e){jqEvent("#nb_events").waypoint("disable"),self.MoreDatesExists&&GetEvents(!1)},{offset:"bottom-in-view",enabled:!1}),jqEvent.ajax({dataType:"jsonp",jsonp:"jsoncallback",url:serverUrl+"/EventWidget/GetTemplateFile/?templateName=nb_event_HeaderV2_template"+settings,success:function(jsonString){var templateContent=eval("("+jsonString+")");self.nbHeaderTemplate=Handlebars.compile(templateContent),finaly()},error:function(){alert("Error load header template")}}),jqEvent.ajax({dataType:"jsonp",jsonp:"jsoncallback",url:serverUrl+"/EventWidget/GetTemplateFile/?templateName=nb_event_EventList_template"+settings,success:function(jsonString){var templateContent=eval("("+jsonString+")");self.nbEventListTemplate=Handlebars.compile(templateContent),finaly()},error:function(){alert("Error load header template")}}),jqEvent.ajax({dataType:"jsonp",jsonp:"jsoncallback",url:serverUrl+"/EventWidget/GetTemplateFile/?templateName=nb_event_EventListFullDay_template"+settings,success:function(jsonString){var templateContent=eval("("+jsonString+")");self.nbEventListFullDayTemplate=Handlebars.compile(templateContent),finaly()},error:function(){alert("Error load header template")}})}).fail(function(e,t,n){alert("Error on load handlebars! "+n)})}function initTicketForm(){jqEvent("#DatesList").change(function(e){jqEvent("#ActiveDate").val(jqEvent(this).val()),jqEvent(".nb-item").hide("slow").delay(500).queue(function(e){nb_event.showPriceForm()})}),jqEvent("span.nb-price-date").click(function(e){jqEvent("#ActiveDate").val(jqEvent(this).data("id")),jqEvent(".nb-item").hide("slow").delay(500).queue(function(e){nb_event.showPriceForm()})}),jqEvent("#orderForm").submit(function(){var e=!0,t=jqEvent(this).find("input[type=text]:empty");return t.length>0&&t.each(function(t){jqEvent(this).hasClass("nb-error")||""!=jqEvent(this).val()||(jqEvent(this).addClass("nb-error").css("border-color","red").after('<div class="nb-error-text">Поле обязательно для заполнения</div>'),e=!1)}),e}),jqEvent(".show-order-form").click(function(e){if(nb_event.GetCart(),jqEvent("#nb-order-form-wrapper").hasClass("isActive")){var t=jqEvent("#nb-tickets-end").offset().top;jqEvent("body:not(:animated)").animate({scrollTop:t},1e3),jqEvent("html").animate({scrollTop:t},500)}else jqEvent("#nb-order-form-wrapper").show().queue(function(e){var t=jqEvent("#nb-tickets-end").offset().top;jqEvent("body:not(:animated)").animate({scrollTop:t},1e3),jqEvent("html").animate({scrollTop:t},500)}).addClass("isActive");return e.preventDefault(),!1}),jqEvent("#orderBtn").click(function(e){e.preventDefault(),jqEvent(this).closest("form").submit()}),jqEvent("#show-order-form").click(function(e){e.preventDefault()})}function finaly(){if(self.NumberOfScriptToLoad=self.NumberOfScriptToLoad-1,0==self.NumberOfScriptToLoad){var e=purl().fparam("eventKey");void 0!=e&&(self.eventKey=e),void 0!=purl().param("startFrom")&&(self.startFrom=purl().param("startFrom")),jqEvent("body").on("click",".showEvent",function(e){e.preventDefault();var t=jqEvent(this).attr("rel");GetEvent(t),jqEvent(window).unbind("resize")}),"function"==typeof nbCustomInit&&nbCustomInit(),void 0!=self.eventKey&&GetEvent(self.eventKey),self.pageTitle=jqEvent("title").text();GetEvents(!0)}}function SetHashLock(e){Log("Hash Lock state set to :"+e),self.lockWindowOnhashchange=e}function GetHashStateAndGetEvents(){self.lockWindowOnhashchange||(Log("GetHashStateAndGetEvents"),GetHashState(),nb_event.GetEvents(!1))}function GetHashState(){}function Log(e){window.console&&self.isDebug&&console.log(e)}function SetHashState(){}function BeforeGetEvents(){jqEvent("#nb_eventsCont").append('<div id="nb_loader"><p/><p/><br>.....Загрузка.....</div>')}function onChangeControls(){SetHashState(),ClearEventsListDiv(),ClearLastDate(),GetEvents(!1)}function onSuccessRecievedGetEvents(e){jqEvent("#nb_loader").remove(),e&&(self.InfiniteScrollDisable||jqEvent("#nb_events").waypoint("enable"))}function ClearEventsListDiv(){jqEvent("#nb_eventsCont").empty()}function GetEventsWithoutTagFilter(){ClearTagFilter(),ClearLastDate(),ClearEventsListDiv(),GetEvents(!1)}function ClearTagFilter(){jqEvent("#nbTagFilter").val("")}function ClearLastDate(){jqEvent("#nbEventsLastDate").val("")}function GetTagIds(){return jqEvent("#nbTagFilter").val()}function GetEventsByTags(e){self.tagsIds=e,jqEvent("#nbTagFilter").val(e),ClearEventsListDiv(),ClearLastDate(),SetHashState(),GetEvents(!1)}function GetEventsFullDay(SecondaryDivId){var regionTag=jqEvent("#regionTag  option:selected").val(),currentTagIds=GetTagIds();jqEvent.ajax({dataType:"jsonp",jsonp:"jsoncallback",url:serverUrl+"/EventWidget/GetEventsFullDay/?widgetKey="+self.siteKey+"&regionTag="+regionTag+"&date="+SecondaryDivId+"&tagIds="+currentTagIds,success:function(jsonString){json=eval("("+jsonString+")");var template=self.nbEventListFullDayTemplate,html=template(json);jqEvent("#sec"+SecondaryDivId).html(html)},error:function(e){lock=!1,alert("Ошибка 500, События не найдены")}})}function SetRequestVariable(){"undefined"!=jqEvent("#nb_topMessageTags")&&""!=jqEvent("#nb_topMessageTags").html()&&(self.regionTag=jqEvent("#regionTag  option:selected").val(),self.startFrom=jqEvent("#datepicker").val(),self.lastDate=jqEvent("#nbEventsLastDate").val(),self.tagsIds=GetTagIds())}function GetWidgetSettings(){var e="";if(void 0!=nb_config&&"undefined"!=nb_config.widgetType)e="&widgetType="+nb_config.widgetType;else{var t=purl().param("widgetType");void 0!=t&&(e="&widgetType="+t)}return e}function GetEvents(needHeader){Log("GetEvents");var p=0,t="";if(0==lock){lock=!0,isNaN(parseInt(p))&&(p=self.page),self.page=p,"undefined"!=typeof t&&t?self.tagsComma=t:(self.tagsComma="",t=""),SetRequestVariable(),BeforeGetEvents();var widgetSettings="";"undefined"!=nb_config.widgetType&&(widgetSettings="&widgetType="+nb_config.widgetType);var needHeaderString="0";needHeader?needHeaderString="1":"undefined"!=jqEvent("#nb_topMessageTags")&&""==jqEvent("#nb_topMessageTags").html()&&(needHeader=!0,needHeaderString="1"),Log("send request GetEvents"),jqEvent.ajax({dataType:"jsonp",jsonp:"jsoncallback",url:serverUrl+"/EventWidget/GetEventsJson/?widgetKey="+self.siteKey+"&regionTag="+self.regionTag+"&needHeader="+needHeaderString+"&startFrom="+self.startFrom+"&lastDate="+self.lastDate+"&tagIds="+self.tagsIds,success:function(jsonString){Log("getEventDone"),json=eval("("+jsonString+")"),1==json.NbcrsEvents[0].MoreDatesExists?self.MoreDatesExists=!0:self.moreDatesExists=!1,self.InfiniteScrollDisable&&(json.InfiniteScrollDisable=!0),CreateHtml(json,needHeader),"undefined"!=json.LastDate&&jqEvent("#nbEventsLastDate").val(json.LastDate)},error:function(e){lock=!1,alert("Ошибка 500, События не найдены")}})}}function CreateHtml(e,t){var n=self.nbEventListTemplate,s=n(e);if(t){var a=self.nbHeaderTemplate(e);jqEvent("#nb_topMessageTags").append(a)}jqEvent("#nb_eventsCont").append(s),jqEvent("#datepicker").datepicker({dateFormat:"dd/mm/yy",onSelect:function(e,t){jqEvent("#nbTagFilter").val(""),ClearEventsListDiv(),ClearLastDate(),GetEvents(!1)}});var i=!1;"undefined"!=e.NbcrsEvents[0].MoreDatesExists&&e.NbcrsEvents[0].MoreDatesExists&&(i=!0),onSuccessRecievedGetEvents(i),lock=!1}function AddWidgetDialog(){var e="";"undefined"!=typeof nb_config.themeId&&(e="&themeId = "+nb_config.themeId),jqEvent.ajax({dataType:"jsonp",url:serverUrl+"/EventWidget/GetAddWidgetDialog/?siteKey="+siteKey+e,jsonp:"jsoncallback",success:function(e){0!=e.Html.length&&(jqEvent(".nb_hidden").html(e.Html),jqEvent(".nb_hidden").dialog({title:e.Name,position:{my:"center",at:"center",of:window},draggable:!1,width:700,resizable:!1,buttons:{"Закрыть":function(){jqEvent(this).dialog("close")}},close:function(){jqEvent(window).bind("resize",resize)}}))},error:function(e){alert("Ошибка 500, Событие не найдено")}})}function GetEvent(e){jqEvent.ajax({dataType:"jsonp",url:serverUrl+"/EventWidget/GetEvent/?siteKey="+siteKey+"&id="+e,jsonp:"jsoncallback",success:function(e){0!=e.Html.length&&(jqEvent(".nb_hidden").html(e.Html),jqEvent(".nb_hidden").dialog({title:e.Name,position:{my:"center",at:"center",of:window},draggable:!1,width:700,resizable:!1,buttons:{"Закрыть":function(){jqEvent(this).dialog("close")}},close:function(){jqEvent(window).bind("resize",resize)}}))},error:function(e){alert("Ошибка 500, Событие не найдено")}})}function GetPage(e){jqEvent("html, body").animate({scrollTop:0},"slow"),GetEvents(e,self.tagsComma)}function SetTagsMessage(e){var t="";t="undefined"==typeof e||""===e?"":"Показаны события с тегом '"+e+"' Показать <a href='#' onclick='event.preventDefault();nb_event.GetByTags()'>все события</a>",jqEvent("#nb_topMessageTags").html(t)}function GetCart(){jqEvent.ajax({dataType:"jsonp",url:serverUrl+"/EventWidget/ShoppingCart/?siteKey="+siteKey,data:jqEvent("#orderForm").serialize(),jsonp:"jsoncallback",success:function(e){jqEvent("#nb-total-count").text(e.totalCount),jqEvent("#nb-total-price").text(e.totalPrice),jqEvent("#ProcessId").text(e.processId),jqEvent("#nb-cart").show()},error:function(e){alert("Ошибка. Продажа билетов на выбранное событие временно недоступна.")}})}function GetByTags(e){jqEvent("html, body").animate({scrollTop:0},"slow"),SetTagsMessage(e),GetEvents(1,e)}var self=this,lock=!1,config={siteKey:""};return self.isDebug=!0,self.eventKey,self.page=1,self.rows=25,self.startFrom="",self.siteKey="",self.pageTitle="",self.tagsComma="",self.tagsIds="",self.regionTag="",self.lastDate="",self.eventCode="",self.history,self.nbHeaderTemplate,self.nbEventListTemplate,self.nbEventListFullDayTemplate,self.NumberOfScriptToLoad=3,self.lockWindowOnhashchange=!1,self.InfiniteScrollDisable=!1,self.MoreDatesExists=!0,{init:init,vote:vote,initTicketForm:initTicketForm,returnSiteKey:returnSiteKey,showPriceForm:showPriceForm,GetEvents:GetEvents,GetEvent:GetEvent,GetPage:GetPage,AddWidgetDialog:AddWidgetDialog,GetByTags:GetByTags,GetCart:GetCart,GetEventsFullDay:GetEventsFullDay,onChangeControls:onChangeControls,GetEventsByTags:GetEventsByTags,NextPage:NextPage,GetEventsWithoutTagFilter:GetEventsWithoutTagFilter}}();